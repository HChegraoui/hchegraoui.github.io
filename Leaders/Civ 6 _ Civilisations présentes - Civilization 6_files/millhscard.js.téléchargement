String.prototype.normalize=function(a){for(var b=[/[\300-\306]/g,/[\340-\346]/g,/[\310-\313]/g,/[\350-\353]/g,/[\314-\317]/g,/[\354-\357]/g,/[\322-\330]/g,/[\362-\370]/g,/[\331-\334]/g,/[\371-\374]/g,/[\321]/g,/[\361]/g,/[\307]/g,/[\347]/g,/[\u2019]/g,/[\u0152]/g,/[\u0153]/g],c=["A","a","E","e","I","i","O","o","U","u","N","n","C","c","'","Oe","oe"],d=this,e=0;e<b.length;e++)d=d.replace(b[e],c[e]);return a?d:d.toLowerCase()},String.prototype.stringSize=function(a){var b="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-_' 1234567890oeOe",c=[11,11,9,11,10,7,10,12,6,6,11,6,17,12,11,11,11,8,8,7,12,9,14,10,10,8,12,12,11,13,12,11,13,14,7,7,13,10,15,13,14,13,14,13,11,11,14,12,18,12,11,10,6,9,3,5,10,10,10,10,10,10,10,10,10,10,15,0,19,0];a&&(c=[8,8,6,8,7,5,7,9,5,4,8,5,12,9,8,8,8,6,6,5,8,7,10,7,7,6,9,9,8,9,8,8,9,10,5,5,10,7,11,9,10,9,10,9,8,8,10,9,13,9,8,7,4,7,2,3,7,7,7,7,7,7,7,7,7,7,12,0,16,0]);var d=this;if(1==d.length){var e=c[b.indexOf(d.normalize(!0))];return e>-1?e:5}for(var e=0,f=0;f<d.length;f++)e+=d[f].stringSize(a)+.4;return e};var millhscard={cache:{},focus:!1,cardType:{4:"Serviteur",5:"Sort",7:"Arme"},cardMinion:{14:"Murloc",15:"Démon",17:"Méca",20:"Bête",21:"Totem",23:"Pirate",24:"Dragon"},init:function(){$(".millhscard").each(function(){millhscard.draw(this)}),$("a").each(function(){var a=$(this).attr("href"),b=new RegExp("https://tools.millenium.org/hearthstone-deckbuilder/carte-([0-9]+)/(.+)");a&&(result=a.match(b))&&millhscard.tooltip(this,result)}),$(".millhsdeck").each(function(){var a=this,b=$(a).attr("data-url"),c=new RegExp("https://tools.millenium.org/hearthstone-deckbuilder/deck-([0-9]+)/(.+)/(.+)"),d=new RegExp("https://tools.millenium.org/hearthstone-deckbuilder/guide-([0-9]+)/(.+)");if(result=b.match(c)){$.getJSON("https://tools.millenium.org/hearthstone-deckbuilder/api/deck-"+result[1]+"/"+result[3],function(b){millhscard.drawCanvas(a,b)}).fail(function(){$(a).html("<!-- millhsdeck : Ce deck n'existe pas -->")})}else if(result=b.match(d)){$.getJSON("https://tools.millenium.org/hearthstone-deckbuilder/api/guide-"+result[1],function(b){millhscard.drawCanvas(a,b)}).fail(function(){$(a).html("<!-- millhsdeck : Ce guide n'existe pas -->")})}else $(a).html("<!-- millhsdeck : Cette url est invalide -->")}),$(document).bind("click touchstart",function(a){clearTimeout(millhscard.timeoutEnter),delete millhscard.timeoutEnter,millhscard.focus=!1,millhscard.remove()})},tooltip:function(a,b){$(a).data("millhstooltip")||($(a).data("millhstooltip",!0),$(a).bind("click",function(b){millhscard.focus&&millhscard.focus==a||b.preventDefault(),b.stopPropagation()}).bind("touchstart",function(a){a.stopPropagation()}).bind("mouseenter",function(c){clearTimeout(millhscard.timeoutLeave),millhscard.timeoutEnter=setTimeout(function(){millhscard.focus=a,millhscard.add(a,b,c)},50)}).bind("mousemove",function(){millhscard.timeoutEnter||0!=millhscard.focus||$(a).trigger("mouseenter")}).bind("mouseleave",function(){clearTimeout(millhscard.timeoutEnter),delete millhscard.timeoutEnter,millhscard.timeoutLeave=setTimeout(function(){millhscard.focus=!1,millhscard.remove()},500)}))},add:function(a,b,c){millhscard.remove();var d=$('<div id="millhstooltip"></div>');d.appendTo("body");var e=$("#millhstooltip");$(e).bind("mouseenter",function(){clearTimeout(millhscard.timeoutLeave)}).bind("mouseleave",function(){millhscard.timeoutLeave=setTimeout(function(){millhscard.focus=!1,millhscard.remove()},500)}).bind("touchstart",function(a){a.stopPropagation()});var f=$(a),g=f.offset().left,h=f.offset().top;if(f.outerWidth()+20>e.outerWidth()&&c.pageX+20+e.outerWidth()<g+f.outerWidth()?(e.css("left",c.pageX+20),millhscard.setTop(h,f,e)):g+f.outerWidth()+e.outerWidth()<$(window).scrollLeft()+$(window).width()?(e.css("left",g+f.outerWidth()),millhscard.setTop(h,f,e)):g-e.outerWidth()>$(window).scrollLeft()?(e.css("left",g-e.outerWidth()),millhscard.setTop(h,f,e)):h-e.outerHeight()>$(window).scrollTop()?(e.css("top",h-e.outerHeight()),millhscard.setLeft(g,f,e)):h+f.outerHeight()+e.outerHeight()<$(window).scrollTop()+$(window).height()?(e.css("top",h+f.outerHeight()),millhscard.setLeft(g,f,e)):(e.css("top",$(window).scrollTop()+$(window).height()/2-e.outerHeight()/2),e.css("left",$(window).scrollLeft()+$(window).width()/2-e.outerWidth()/2)),millhscard.cache[b[1]]){var i=millhscard.getCard(millhscard.cache[b[1]],!0);e.html(i),millhscard.draw(e.find(".millhscard"))}else $.ajax({type:"GET",url:"https://tools.millenium.org/hearthstone-deckbuilder/api/carte-"+b[1]}).done(function(a){millhscard.cache[b[1]]=a;var c=millhscard.getCard(a,!0);e.html(c),millhscard.draw(e.find(".millhscard"))})},remove:function(){$("#millhstooltip").remove()},setLeft:function(a,b,c){a+b.outerWidth()/2-c.outerWidth()/2<$(window).scrollLeft()||c.outerWidth()>$(window).width()?c.css("left",$(window).scrollLeft()):a+b.outerWidth()/2+c.outerWidth()/2>$(window).scrollLeft()+$(window).width()?c.css("left",$(window).scrollLeft()+$(window).width()-c.outerWidth()):c.css("left",a+b.outerWidth()/2-c.outerWidth()/2)},setTop:function(a,b,c){a+b.outerHeight()/2-c.outerHeight()/2<$(window).scrollTop()||c.outerHeight()>$(window).height()?c.css("top",$(window).scrollTop()):a+b.outerHeight()/2+c.outerHeight()/2>$(window).scrollTop()+$(window).height()?c.css("top",$(window).scrollTop()+$(window).height()-c.outerHeight()):c.css("top",a+b.outerHeight()/2-c.outerHeight()/2)},draw:function(a){var b=$(a).css("transform"),c=new Image;if(c.onload=function(){$(a).css("background-image","url('"+c.src+"')")},$random=$(a).attr("data-refresh")?"?rdm="+Math.floor(1e4*Math.random()):"","none"!=b){var d=b.match(/matrix\((-?\d*\.?\d+),.+/)[1];parseFloat(d)>.75?c.src="https://tools.millenium.org/hearthstone-deckbuilder/img/cards/card"+$(a).attr("data-cardid")+"l.png"+$random:parseFloat(d)>.33?c.src="https://tools.millenium.org/hearthstone-deckbuilder/img/cards/card"+$(a).attr("data-cardid")+"m.png"+$random:c.src="https://tools.millenium.org/hearthstone-deckbuilder/img/cards/card"+$(a).attr("data-cardid")+"s.png"+$random}else c.src="https://tools.millenium.org/hearthstone-deckbuilder/img/cards/card"+$(a).attr("data-cardid")+"l.png"+$random;var e="Arme";$(a).hasClass("millhs_typeServiteur")?e="Serviteur":$(a).hasClass("millhs_typeSort")&&(e="Sort");var f=$(a).find(".millhs_name").html();if(f=f.replace("&nbsp;"," "),"Arme"!=e){if($(a).find(".millhs_name").html(""),"13px"==$(a).find(".millhs_name").css("font-size"))var g=f.stringSize(!0);else var g=f.stringSize();var h=(277-g)/2,j=0,k=0;for(i=0;i<f.length;i++){if($(a).find(".millhs_name").append('<span id="millhs_char'+i+'">'+f[i]+"</span>"),"13px"==$(a).find(".millhs_name").css("font-size"))var l=f[i].stringSize(!0),m=16;else var l=f[i].stringSize(),m=22;var n=millhscard.wavingT((h-147)/10,e);h+=(.2+l/2)*Math.cos(n),j=millhscard.waving((h-147)/10,e),k=millhscard.wavingT((h-147)/10,e);var o=-l/2,p=-m;$(a).find("#millhs_char"+i).css("top",millhscard.round100(j+p)+"px"),$(a).find("#millhs_char"+i).css("left",millhscard.round100(h+o)+"px"),$(a).find("#millhs_char"+i).css("transform","rotate("+millhscard.round100(180*k/Math.PI)+"deg) translate3d(0px,0px,1px)"),h+=(.2+l/2)*Math.cos(k)}}},drawCanvas:function(a,b){var c=$('<div class="millhs_decklist"><div class="millhs_decklistClass"><div class="millhs_decklistTitle"><span class="millhs_decklistHeader1 listClass'+b.class+'"></span><span class="millhs_decklistHeader2">Cartes de classe<span id="countDeck1"> ('+b.count0+')</span></span><div id="drawDeck1"></div></div></div><div class="millhs_decklistNeutral"><div class="millhs_decklistTitle"><span class="millhs_decklistHeader1 listClass1"></span><span class="millhs_decklistHeader2">Cartes neutres<span id="countDeck2"> ('+b.count1+')</span></span><div id="drawDeck2"></div></div></div></div>');$(a).html(c),millhscard.drawCards(a,b.cards,b.cards)},drawCards:function(a,b,c,d){for(var e in b){var f=c[e].n.length>20?" millhs_deckCardName_small":"",g='<div class="millhs_deckCardNameFull'+f+'" style="background-image:url(\'https://tools.millenium.org/hearthstone-deckbuilder/img/cards/card'+b[e].id+"d.png');\">"+c[e].n+"</div>";2==b[e].count?g='<div class="millhs_deckCardName'+f+'" style="background-image:url(\'https://tools.millenium.org/hearthstone-deckbuilder/img/cards/card'+b[e].id+"d.png');\">"+c[e].n+'</div><div class="millhs_deckCardCount">2</div>':5==c[e].r&&(g='<div class="millhs_deckCardName'+f+'" style="background-image:url(\'https://tools.millenium.org/hearthstone-deckbuilder/img/cards/card'+b[e].id+"d.png');\">"+c[e].n+'</div><div class="millhs_deckCardStar"></div>');var h="https://tools.millenium.org/hearthstone-deckbuilder/carte-"+b[e].id+"/"+c[e].n;1==d&&(h="javascript:millhs.removeCard("+b[e].id+")");var i=$('<div id="millhs_deckCard-'+b[e].id+'" class="millhs_deckCard"><a href="'+h+'"><div class="millhs_deckCardCost">'+c[e].g+"</div>"+g+"</a></div>");if(1==d)if(""==$("#drawDeck").html())i.appendTo("#drawDeck");else for(var j in b){if(e==j){i.appendTo("#drawDeck");break}if(parseInt(c[j].g)>parseInt(c[e].g)||parseInt(c[j].g)==parseInt(c[e].g)&&c[j].n.normalize()>c[e].n.normalize()){i.insertBefore("#deckCard-"+b[j].id);break}}else 1==c[e].c?i.appendTo($(a).find("#drawDeck2")):i.appendTo($(a).find("#drawDeck1"));millhscard.tooltip(i,["https://tools.millenium.org/hearthstone-deckbuilder/carte-"+b[e].id+"/"+c[e].n,b[e].id,c[e].n])}},getCard:function(a,b){var c=parseInt(a.t)>0?millhscard.cardType[a.t]:a.t,d=parseInt(a.m)>0?millhscard.cardMinion[a.m]:0!=a.m?a.m:"";return $('<div id="card-'+a.id+'" class="millhs_card"><a href="'+(b?"https://tools.millenium.org/hearthstone-deckbuilder":"/hearthstone-deckbuilder")+"/carte-"+a.id+"/"+a.n+'"><div class="millhscard millhs_type'+c+'" data-cardid="'+a.id+'" data-refresh=""><div class="millhs_cost">'+a.g+'</div><div class="millhs_name'+(a.n.length>21?" millhs_small":"")+'">'+a.n+'</div><div class="millhs_desc"><div>'+a.d+'</div></div><div class="millhs_attack">'+(a.a?a.a:"")+'</div><div class="millhs_minion">'+d+'</div><div class="millhs_life">'+(a.l?a.l:"")+(a.b?a.b:"")+"</div></div></a></div>")},round100:function(a){return Math.round(100*a)/100},waving:function(a,b){return"Serviteur"==b?(12*Math.pow(a,2)+1.5*Math.pow(a,3))/130:"Sort"==b?Math.pow(a+1,2)/7:0},wavingT:function(a,b){return"Serviteur"==b?Math.atan((24*a+4.5*Math.pow(a,2))/1300):"Sort"==b?Math.atan(2*(a+1)/70):0}};$(document).ready(function(){millhscard.init()});